<?php

use MageOS\Widgetkit\Block\Widgets\Slideshow;

/**
 * @var Slideshow $this
 */

$params = $this->getData('params');
$item = $this->getData('item');

if ($item['image']) {
    $src = $item['image'];
    $image = [
        'src' => $src,
        'alt' => $item['image_alt'],
        'loading' => $item['count'] === 0 ? 'eager' : $params['mageos_slideshow_image_loading'],
        'width' => isset($params['image_width']) ?? false,
        'height' => isset($params['image_height']) ?? false
    ];
} else {
    return;
}

$duration = 'duration-' . (int) $params['mageos_slideshow_speed'] ?? 300;
$mobileImage = $item['mobile_image'] ?? null;
?>
<picture
    x-data="{ index: <?= (int)$item['count'] ?> }"
    class="absolute inset-0">
    <?php if ($mobileImage): ?>
    <source
        media="(max-width: 768px)"
        srcset="<?= htmlspecialchars($mobileImage, ENT_QUOTES, 'UTF-8') ?>"
        type="image/jpeg"
    />
    <?php endif; ?>
    <img
        src="<?= $image['src']; ?>"
        class="absolute inset-0 h-full w-full object-cover"
        <?php if ($image['loading'] === 'eager'): ?>
            fetchpriority="high"
            loading="eager"
        <?php else: ?>
            loading="lazy"
        <?php endif; ?>
        role="group"
        aria-roledescription="slide"
        x-bind:aria-label="`Image slide ${index + 1} of ${images.length}`"
        x-bind:aria-hidden="currentIndex !== index"
    />
</picture>
